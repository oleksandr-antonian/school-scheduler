import{d as W,_ as X,r as k,o as Y,c,a as l,b as H,F as j,e as P,f as q,g as i,t as z,n as G,h as K,i as Q}from"./index-CkQGRKbG.js";import{u as F}from"./classStore-DQ1Ihgyy.js";import{u as J}from"./subjectStore-B3_kWw-b.js";import{u as I}from"./teacherStore-BKk-xo9p.js";import{v as R}from"./v4-C6aID195.js";const U=W("lessonStore",{state:()=>({lessons:JSON.parse(localStorage.getItem("lessons"))||[]}),actions:{generateLessons(){const d=F(),L=J(),b=I(),o=this.lessons,u=d.classes,_=L.subjects,C=b.teachers,m=5,x=7;u.forEach(w=>{const N=_.filter(s=>s.classId===w.id);N.length!==0&&(N.map(s=>s.lessonsPerWeek).reduce((s,h)=>s+h,0),N.forEach(s=>{const h=C.find(f=>f.id===s.teacherId),S=s.lessonsPerWeek,E=Math.ceil(S/m);if(o.filter(f=>f.subjectId===s.id).length!==S)for(let f=0;f<m;f++){const T=o.filter(y=>y.subjectId===s.id).length;if(S-T<=0)break;for(let y=0;y<x;y++)o.filter(p=>p.subjectId===s.id&&p.day===f).length===E||o.some(p=>p.classId===w.id&&p.day===f&&p.lessonNumber===y)||o.some(p=>p.teacherId===h.id&&p.day===f&&p.lessonNumber===y)||o.push({id:R(),classId:w.id,subjectId:s.id,teacherId:h.id,day:f,lessonNumber:y})}}))}),this.lessons=o,this.updateLocalStorage()},deleteLessons(){this.lessons=[],this.updateLocalStorage()},updateLesson(d,L){const b={...d,...L},o=this.lessons.find(u=>u.day===b.day&&u.lessonNumber===b.lessonNumber&&u.classId===b.classId);if(o){const u={...o,day:d.day,lessonNumber:d.lessonNumber};this.lessons=this.lessons.map(_=>_.id===o.id?u:_)}this.lessons=this.lessons.map(u=>u.id===d.id?b:u),this.updateLocalStorage()},removeLesson(d){this.lessons.splice(d,1),this.updateLocalStorage()},updateLocalStorage(){localStorage.setItem("lessons",JSON.stringify(this.lessons))},loadFromLocalStorage(){const d=JSON.parse(localStorage.getItem("lessons"));d&&(this.lessons=d)}}}),Z={class:"flex items-center justify-between"},ee={key:0,class:"bg-red-500 rounded text-white text-lg py-2 px-4"},se={key:1,class:"bg-green-500 rounded text-white text-lg py-2 px-4"},te={class:"flex items-center justify-between gap-3"},oe={key:0,class:"my-8 overflow-x-auto"},ne={class:"flex items-center sticky top-0"},le={class:"w-12 flex-shrink-0 sticky left-0 bg-white border h-48 rotate-180 [writing-mode:vertical-rl] flex items-center justify-center"},re=["onDragover","onDrop"],ae=["onDragstart"],ce={key:1,class:"border rounded text-xss p-1 bg-gray-50 text-gray-400 flex items-center justify-between"},ie={key:1},de={class:"flex items-center flex-col bg-gray-100 my-8 rounded p-8"},ue={__name:"HomeView",setup(d){const L=["Понеділок","Вівторок","Середа","Четвер","П'ятниця"],b=[1,2,3,4,5,6,7],o=U(),u=F(),_=J(),C=I(),m=k(o.lessons),x=k(u.classes),w=k(_.subjects),N=k(C.teachers),s=k({}),h=k(null),S=k([]),E=n=>{const e=new Map;return n.forEach(t=>{const a=`${t.day}-${t.lessonNumber}-${t.teacherId}`;e.has(a)||e.set(a,[]),e.get(a).push(t)}),Array.from(e.values()).filter(t=>t.length>1)},D=()=>{S.value=E(m.value),L.forEach((n,e)=>{const t={};x.value.forEach(a=>{const v={};for(let r=0;r<7;r++){const V=m.value.find(g=>g.classId===a.id&&g.day===e&&g.lessonNumber===r);v[r]=V||null}t[a.id]=v}),s.value[e]=t})},f=n=>{h.value=n},T=(n,e)=>{h.value&&h.value.classId===e&&n.preventDefault()},B=(n,e,t)=>{h.value&&h.value.classId===e&&(o.updateLesson(h.value,{day:n,classId:e,lessonNumber:t}),Q(()=>{A()}),h.value=null)},y=n=>S.value.some(e=>e.some(t=>t.id===n));Y(()=>{A()});const A=()=>{o.generateLessons(),m.value=o.lessons,D()},M=()=>{o.deleteLessons(),m.value=o.lessons,D()},O=n=>{const e=w.value.find(t=>t.id===n);return e?e.name:""},p=n=>{const e=N.value.find(t=>t.id===n);return e?e.color:""};return(n,e)=>{const t=q("Button");return i(),c(j,null,[l("div",Z,[e[3]||(e[3]=l("h1",{class:"text-2xl font-bold"},"Уроки",-1)),l("div",null,[S.value.length?(i(),c("div",ee,e[1]||(e[1]=[l("span",null,"Знайдено дублікати уроків",-1)]))):(i(),c("div",se,e[2]||(e[2]=[l("span",null,"Дублікатів уроків немає",-1)])))]),l("div",te,[H(t,{onClick:M,icon:"pi pi-trash",severity:"secondary",label:"Видалити уроки",iconPos:"right",size:"small"}),H(t,{onClick:A,icon:"pi pi-refresh",label:"Згенерувати уроки",iconPos:"right",size:"small"})])]),x.value.length?(i(),c("div",oe,[l("div",ne,[e[4]||(e[4]=l("div",{class:"w-12 border h-12 flex-shrink-0 sticky left-0 bg-white"},null,-1)),(i(!0),c(j,null,P(x.value,a=>(i(),c("div",{key:a.id,class:"w-48 border h-12 flex flex-shrink-0 items-center justify-center"},z(a.name),1))),128))]),(i(),c(j,null,P(L,(a,v)=>l("div",{class:"flex items-center",key:a},[l("div",le,z(a),1),(i(!0),c(j,null,P(x.value,r=>(i(),c("div",{key:r.id,class:"w-48 flex-shrink-0 border h-48 p-0.5 flex flex-col"},[(i(),c(j,null,P(b,(V,g)=>l("div",{key:g,class:"m-0.5",onDragover:$=>T($,r.id),onDrop:$=>B(v,r.id,g)},[s.value[v]&&s.value[v][r.id]&&s.value[v][r.id][g]?(i(),c("div",{key:0,draggable:"true",onDragstart:$=>f(s.value[v][r.id][g]),class:G(["border rounded text-xss p-1 text-black flex items-center cursor-grab justify-between",{"border-red-500 !text-white !bg-red-500":y(s.value[v][r.id][g].id)}]),style:K({backgroundColor:p(s.value[v][r.id][g].teacherId)})},[l("span",null,z(O(s.value[v][r.id][g].subjectId)),1)],46,ae)):(i(),c("div",ce,e[5]||(e[5]=[l("span",null,"Вільно",-1)])))],40,re)),64))]))),128))])),64))])):(i(),c("div",ie,[l("div",de,[e[6]||(e[6]=l("p",{class:"mb-4"},"Додайте класи",-1)),H(t,{onClick:e[0]||(e[0]=a=>n.$router.push("/classes")),icon:"pi pi-plus",label:"Додати клас",iconPos:"right",size:"small"})])]))],64)}}},ye=X(ue,[["__scopeId","data-v-e529e194"]]);export{ye as default};
